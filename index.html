<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Predicting Drug Treatment Program Adherence by TNames</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Predicting Drug Treatment Program Adherence</h1>
      <h2 class="project-tagline">Analysis by Taylor Names</h2>
      <a href="https://github.com/TNames/DRUG_TREATMENT_PROJECT" class="btn">View on GitHub</a>
      <a href="https://github.com/TNames/DRUG_TREATMENT_PROJECT/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/TNames/DRUG_TREATMENT_PROJECT/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="project-overview" class="anchor" href="#project-overview" aria-hidden="true"><span class="octicon octicon-link"></span></a>PROJECT OVERVIEW</h1>

<h3>
<a id="background-and-motivation" class="anchor" href="#background-and-motivation" aria-hidden="true"><span class="octicon octicon-link"></span></a>BACKGROUND AND MOTIVATION</h3>

<p>How to treat drug users is a controversial and timely issue currently in the United States. In the last 15 or so years, an increasing amount of convicted drug users have been given the option (or have been required) to complete a drug treatment program instead of  serving time in prison. Completing treatment instead of spending time in jail have many psycological, financial, health and social benefits. </p>

<p>Many questions surround the current state of drug treatment: </p>

<ul>
<li>
<strong>Are these programs helping drug users get back on track?</strong> </li>
<li><strong>Who is likely to succeed and complete these programs and who isn't?</strong></li>
<li><strong>What type of treatment is right for a specific individual and will they adhere to program guidelines?</strong></li>
<li><strong>Are there certain demographic groups for whom drug treatment is not working?</strong></li>
</ul>

<p>Having data driven insights to help answer these questions can have many practical benefits:</p>

<ul>
<li>More efficient use of public and private financial resources</li>
<li>Individually tailored treatment programs to increase probability of successful treatment</li>
<li>Identification of high risk individuals</li>
<li>Identification of high performing state drug treatment programs</li>
</ul>

<p>Besides the possible practical benefits of the analysis of the dataset, the size and scope of dataset presents many interesting computational challenges.</p>

<h3>
<a id="the-data" class="anchor" href="#the-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>THE DATA</h3>

<p>The data includes <em>demographic, geographic, education and employment, drug use history, and treatment program outcome</em> information for approximately <strong>9.8 million treatment episodes</strong> between the years 2006 and 2011. The data does not contain information relating to drug use relapse after the termination of the treatment episode.</p>

<p>The data is made public by the Substance Abuse &amp; Mental Health Services Administration (SAMHSA) and the data is hosted by the Inter-university Consortium for Political and Social Research (ICPSR) at this <a href="http://www.icpsr.umich.edu/icpsrweb/ICPSR/studies/30122">website</a> The data consists of 65 features, most of which are  entirely categorical. The specific data utilized for this analysis in .tsv format can be downloaded from this <a href="https://www.dropbox.com/s/s82zljp2ceaxvaz/DRUG_TREATMENT_DATA.zip?dl=0">link.</a></p>

<h3>
<a id="project-objectives" class="anchor" href="#project-objectives" aria-hidden="true"><span class="octicon octicon-link"></span></a>PROJECT OBJECTIVES</h3>

<ul>
<li>Predict whether new drug treatment episode will conclude positively</li>
<li>Predict the probability of positive conclusion of a new treatment episode</li>
<li>Understand the drivers of successful drug treatment</li>
<li>Identify profiles of drug users particularly vulnerable to non-completion of treatment</li>
<li>Distinguish between state treatment program adherence rates</li>
</ul>

<p>Hypothetically, with this tool, a drug treatment program administrator could identify the different probabilities of completion of a variety of treatment programs for a given individual and in turn make an informed decision that could lead to more efficient use of resources.</p>

<h3>
<a id="methodology" class="anchor" href="#methodology" aria-hidden="true"><span class="octicon octicon-link"></span></a>METHODOLOGY</h3>

<p>The data was provided in a very organised and well documented fashion but as with most data, there were many missing values. The missing data were either dropped, made equal to the most frequent value or imputed using a random forest algorithm. Then for the remaining features, a web scraping routine was developed to gather descriptions for the numerically encoded categories. Using these descriptions we could then explore the data by visualising the effect of single and dual variables on treatment adherence rate. Also, further visual exploration of the data was done using Tableau. From the insights gained from the exploratory analysis the features were selected and random forest , 'Elastic Net' multiple logistic regression and gradient boosted tree classifiers were created. Finally, the three models were combined using a unregularized logistic regression model with the final output being predictive probabilities of treatment program adherence.</p>

<h1>
<a id="exploratory-analysis" class="anchor" href="#exploratory-analysis" aria-hidden="true"><span class="octicon octicon-link"></span></a>EXPLORATORY ANALYSIS</h1>

<h3>
<a id="relationship-between-single-features-and-adherence" class="anchor" href="#relationship-between-single-features-and-adherence" aria-hidden="true"><span class="octicon octicon-link"></span></a>RELATIONSHIP BETWEEN SINGLE FEATURES AND ADHERENCE</h3>

<p>To gain some insight about the relationship between demographic, geographic, personal characteristics, treatment type and treatment program adherence we plotted the relationship between the two. Some of the most critical features are plotted below.</p>

<p><img src="/DRUG_TREATMENT_PROJECT/tree/gh-pages/plots/age_tot.png" alt="age_tot"></p>

<p><img src="plots/EDUC_TOT.png" alt="EDUC_TOT"></p>

<p><img src="/plots/REGION_TOT.png" alt="REGION_TOT"></p>

<p><img src="/plots/treatment_type_tot.png" alt="treatment_type_tot"></p>

<p>These relationships are also explored on a proportional basis. The plots below show the mean adherence rates for individual characteristics as compared to the mean adherence rate from all participants.</p>

<p><img src="/plots/DIVISION_PROP.png" alt="DIVISION_PROP"></p>

<p><img src="/plots/TREAT_TYPE_PROP.png" alt="TREAT_TYPE_PROP"></p>

<p><img src="/plots/INCOME_PROP.png" alt="INCOME_PROP"></p>

<p>Most categories have an adherence rate similar to the population mean, however, certain features stood out. Below are some best and worst groups in terms of adherence rate:</p>

<p><strong>UNDERPERFORMING GROUPS</strong></p>

<ul>
<li>18-20 year olds</li>
<li>Puerto Rican ethnicity</li>
<li>Primary source of income: public assistance</li>
<li>Residents of Wyoming, Virginia, Indiana, Idaho, Georgia, Arizona</li>
<li>Ambulatory non-intensive outpatient treatment participants</li>
<li>Medication assisted opioid therapy participants</li>
<li>Primary drug of use: over-the-counter medications</li>
<li>Primary drug of use: heroin</li>
</ul>

<p><strong>HIGH-ACHIEVING GROUPS</strong></p>

<ul>
<li><p>55 years and older</p></li>
<li><p>16 Years or more of education</p></li>
<li><p>Current inmates in correctional facility</p></li>
<li><p>Residents of Tennessee, South Dakota, New Mexico, New Hampshire, Colorado, DC, Florida</p></li>
<li><p>Short term rehabilitation and detox participants</p></li>
<li><p>Criminal justice referral type: DUI</p></li>
<li>
<p>Primary drug of use: alcohol</p>

<p>​</p>
</li>
</ul>

<h3>
<a id="geographic-factors" class="anchor" href="#geographic-factors" aria-hidden="true"><span class="octicon octicon-link"></span></a>GEOGRAPHIC FACTORS</h3>

<p>The relationships between adherence rates and demographic factors are explored in detail in the following Tableau interactive visualisation.</p>

<p></p><div>
<a href="#"><img alt="Dashboard 1 " src="https://public.tableau.com/static/images/DR/DRUG_TREATMENT_PROJECT/Dashboard1/1_rss.png"></a>  </div>

<h3>
<a id="feature-interactions" class="anchor" href="#feature-interactions" aria-hidden="true"><span class="octicon octicon-link"></span></a>FEATURE INTERACTIONS</h3>

<p>The <strong>analysis of single features</strong> is useful, but **neglects to consider interactions between features. For example, it may be interesting to know what is the adherence rate of heroin users from Wyoming. </p>

<p>The interactions with the greatest difference in adherence rate from the mean are extremely rare occurrences. For example, one of the interaction terms with the lowest adherence rate (of 0%) belongs to Asian or Pacific islander who is a user of 'other stimulants'. Since there is only one sample that applies, it is unlikely that the true adherence rate for Asian stimulant users is 0.0. To form more realistic estimates for the adherence rate for interaction term, we performed Bayesian inference to shrink (or regularize) small sample size interactions toward the general mean. </p>

<p><img src="/plots/INTERACTION_REG.png" alt="INTERACTION_REG"></p>

<p>The most relevant interaction terms were included as features in the 'Elastic Net' logistic regression.</p>

<h1>
<a id="prediction" class="anchor" href="#prediction" aria-hidden="true"><span class="octicon octicon-link"></span></a>PREDICTION</h1>

<p>Predicted probabilities of treatment adherence were formulated through the creation of three models: random forest classifier, 'Elastic Net' logistic regression with stochastic gradient descent optimisation, and gradient boosted trees classifier.</p>

<h3>
<a id="feature-importances-from-models" class="anchor" href="#feature-importances-from-models" aria-hidden="true"><span class="octicon octicon-link"></span></a>FEATURE IMPORTANCES FROM MODELS</h3>

<p>For each of the models, it is possible to explore 'feature importance' which identify the features that aided the model the most in making accurate predictions.</p>

<p><img src="/plots/RF_FI.png" alt="RF_FI"></p>

<p><img src="/plots/LR_FI.png" alt="LR_FI"></p>

<p><img src="/plots/GBT_FI.png" alt="GBT_FI"></p>

<p>These calculated feature importances reinforce some of the insights that we gained from exploratory data analysis as geographic factors, treatment program type, and age contribute significantly to the predictive modelling. </p>

<h3>
<a id="calibration" class="anchor" href="#calibration" aria-hidden="true"><span class="octicon octicon-link"></span></a>CALIBRATION</h3>

<p>To evaluate the performance of the models, we check to see if they are properly calibrated. An example of calibration is: do the participants who are predicted to have a 90% probability of adherence adhere 90% of the time? For a perfectly calibrated model, this will be the case for all probability values.</p>

<p>​                          <strong>UNCALIBRATED GRADIENT BOOSTED TREE MODEL</strong><img src="/plots/GBT_PRE_CAL.png" alt="GBT_PRE_CAL"></p>

<p>As we can see from the above plot, the gradient boosted tree classifier underestimates the probability of adherence as the entire curve falls above the 'perfectly calibrated'  dotted line. </p>

<p>Often times, improved calibration leads to improved predictive power. Each of the models were calibrated using 'isotonic' calibration in an attempt to improve their performance.</p>

<p>​                             <strong>CALIBRATED GRADIENT BOOSTED TREE MODEL</strong><img src="/plots/GBT_POS_CAL.png" alt="GBT_POS_CAL"></p>

<p>After performing 'isotonic' calibration, we see a significant improvement in the calibration as the curve is much closer to the 'perfectly calibrated' line.</p>

<h3>
<a id="ensemble-of-three-models" class="anchor" href="#ensemble-of-three-models" aria-hidden="true"><span class="octicon octicon-link"></span></a>ENSEMBLE OF THREE MODELS</h3>

<p>Finally, the three models were combined in an 'ensemble' model using unregularized logistic regression.</p>

<p>​                                         <strong>CALIBRATION OF ENSEMBLE MODEL</strong></p>

<p><img src="/plots/ENS_CAL.png" alt="ENS_CAL"></p>

<p>Model performance was measured using <strong>'Log Loss'</strong> which is a measure of error when probabilities are being estimated. A log loss value of zero signifies that the model has no error.</p>

<p><img src="/plots/LOG_LOSS_SCORE.png" alt="LOG_LOSS_SCORE"></p>

<p>Another performance metric utilised in analysis was <strong>simple accuracy</strong>. Probability estimates less than 50% were classified as 'didn't adhere' and above as 'adhered'.</p>

<p><img src="/plots/ACCURACY_SCORE.png" alt="ACCURACY_SCORE"></p>

<p>The final ensemble model is <strong>well calibrated</strong> and with a final log-loss and accuracy scores that are very similar to those from the GBT model. The ensemble model is a <strong>significant improvement upon the baseline 63% model</strong> as it yields a higher accuracy and gives a personalized prediction for each individual.</p>

<h1>
<a id="conclusions-and-further-research" class="anchor" href="#conclusions-and-further-research" aria-hidden="true"><span class="octicon octicon-link"></span></a>CONCLUSIONS AND FURTHER RESEARCH</h1>

<p><strong>REEVALUATING ASSUMPTIONS</strong></p>

<p>A crucial assumption made that could have affected model performance was to group transferred participants together with participants who completed treatment. Although they are both 'positive' conclusions to treatment, they are quite different results. Model performance could be improved through further investigation of the causes for transferring participants and possibly implementing a ternary response variable (<em>completed, transferred, not completed</em>). </p>

<p><strong>MODEL IMPROVEMENT</strong></p>

<p>As expected, the tree based models performed very well on this dataset. Since the models were trained on such a large quantity of data and had very similar performance, it is likely that the main way to improve performance is not to implement more complex models, but to focus more energy on feature engineering.</p>

<p><strong>MORE FEATURE ENGINEERING</strong></p>

<p>Although there was a significant improvement upon the baseline models, the overall model still struggles with the outcome prediction for some individuals. There are many other factors that can contribute to treatment completion. Including data relating to family ties (contact with parents, having brothers and sisters) could help improve the model. As to protect the anonymity of the treatment providers, the dataset provided limited information about details from the treatment program. Data relating to treatment program affiliation (private, public, faith based) as well as program details such as amount of time in contact with health professionals and psychiatric care could also increase the accuracy of the model.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/TNames/DRUG_TREATMENT_PROJECT">Predicting Drug Treatment Program Adherence</a> is maintained by <a href="https://github.com/TNames">TNames</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
